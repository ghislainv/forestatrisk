
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>New Caledonia &#8212; forestatrisk — Modelling and forecasting deforestation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Get started using R" href="../../notebooks_R/get_started_R.html" />
    <link rel="prev" title="ForestAtRisk Tropics" href="../far_tropics.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo-far.svg" alt="Logo"/>
    
    <h1 class="logo logo-name">forestatrisk</h1>
    
  </a>
</p>



<p class="blurb">Modelling and forecasting deforestation in the tropics</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ghislainv&repo=forestatrisk&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html">Get started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../articles.html">Articles</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../articles.html#python-notebooks">Python notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../articles.html#r-notebooks">R notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../package_contents.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../articles.html">Articles</a><ul>
      <li>Previous: <a href="../far_tropics.html" title="previous chapter">ForestAtRisk Tropics</a></li>
      <li>Next: <a href="../../notebooks_R/get_started_R.html" title="next chapter">Get started using R</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="new-caledonia">
<h1>New Caledonia<a class="headerlink" href="#new-caledonia" title="Permalink to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../../_images/nb_newcal_banner.png"><img alt="../../_images/nb_newcal_banner.png" src="../../_images/nb_newcal_banner.png" style="width: 1100px;" /></a>
<section id="introduction">
<h2>1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>This notebook presents the approach used to model and forecast
deforestation in New Caledonia.</p>
<p>The approach is based on a methodology described in the following
article:</p>
<p><strong>Vieilledent G., C. Vancutsem, and F. Achard.</strong> Forest refuge areas and
carbon emissions from tropical deforestation in the 21<sup>st</sup>century.</p>
<p>More information on the method can be find at the ForestAtRisk
website: <a class="reference external" href="https://forestatrisk.cirad.fr">https://forestatrisk.cirad.fr</a>.</p>
<section id="importing-python-modules">
<h3>1.1 Importing Python modules<a class="headerlink" href="#importing-python-modules" title="Permalink to this heading">¶</a></h3>
<p>We import the Python modules needed for running the analysis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copy2</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">ee</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrices</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">from</span> <span class="nn">pywdpa</span> <span class="kn">import</span> <span class="n">get_token</span>
<span class="kn">import</span> <span class="nn">forestatrisk</span> <span class="k">as</span> <span class="nn">far</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># forestatrisk: modelling and forecasting deforestation in the tropics.</span>
<span class="c1"># https://ecology.ghislainv.fr/forestatrisk/</span>
</pre></div>
</div>
<p>We create some directories to hold the data and the ouputs with the
function <code class="docutils literal notranslate"><span class="pre">far.make_dir()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">far</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="s2">&quot;data_raw&quot;</span><span class="p">)</span>
<span class="n">far</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">far</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We increase the cache for GDAL to increase computational speed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># GDAL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GDAL_CACHEMAX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1024&quot;</span>
</pre></div>
</div>
</section>
<section id="set-credentials">
<h3>1.2 Set credentials<a class="headerlink" href="#set-credentials" title="Permalink to this heading">¶</a></h3>
<p>We need to configure and set credentials for:</p>
<ul class="simple">
<li><p>Google Earth Engine (GEE) API</p></li>
<li><p>RClone to access Google Drive</p></li>
<li><p>WDPA API</p></li>
</ul>
<p>You will need a <a class="reference external" href="https://www.google.com/account/about/">Google account</a> for using the GEE API and accessing
Google Drive.</p>
<section id="access-to-google-earth-engine-api">
<h4>1.2.1 Access to Google Earth Engine API<a class="headerlink" href="#access-to-google-earth-engine-api" title="Permalink to this heading">¶</a></h4>
<p>Google Earth Engine is used to compute the past forest cover change
from Vancutsem et al. 2021 or Hansen et al. 2013. To get credentials
for using the Google Earth Engine API, follow these
<a class="reference external" href="https://developers.google.com/earth-engine/guides/python_install-conda#get_credentials">instructions</a>. While authentication with <code class="docutils literal notranslate"><span class="pre">ee.Authenticate()</span></code> should be
necessary only once, you have to execute the command <code class="docutils literal notranslate"><span class="pre">ee.Initialize()</span></code>
at each session.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to authenticate for the first time.</span>
<span class="c1"># ee.Authenticate()</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
</pre></div>
</div>
<p>Under Linux and Mac, credentials are stored in
<code class="docutils literal notranslate"><span class="pre">$HOME/.config/earthengine/credentials</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="nv">$HOME</span>/.config/earthengine/credentials
</pre></div>
</div>
</section>
<section id="access-to-google-drive-with-rclone">
<h4>1.2.2 Access to Google Drive with RClone<a class="headerlink" href="#access-to-google-drive-with-rclone" title="Permalink to this heading">¶</a></h4>
<p>RClone is used to download the forest cover change raster locally from
Google Drive. To install RClone, follow these <a class="reference external" href="https://rclone.org/install/">instructions for
RClone</a>. To configure the access to your Google Drive, follow these
<a class="reference external" href="https://rclone.org/drive/">instructions for accessing Google Drive</a>.</p>
</section>
<section id="access-to-wdpa-api">
<h4>1.2.3 Access to WDPA API<a class="headerlink" href="#access-to-wdpa-api" title="Permalink to this heading">¶</a></h4>
<p>We will be using the <a class="reference external" href="https://ecology.ghislainv.fr/pywdpa/">pywda</a> Python package to collect the data on
protected areas from the World Database on Protected Areas (WDPA) at
<a class="reference external" href="https://www.protectedplanet.net">https://www.protectedplanet.net</a>. To access the Protected Planet API,
you must first obtain a Personal API Token by filling in the form
available at <a class="reference external" href="https://api.protectedplanet.net/request">https://api.protectedplanet.net/request</a>. Then you need to
set an environment variable (we recommend using the name <code class="docutils literal notranslate"><span class="pre">WDPA_KEY</span></code>)
using either the command <code class="docutils literal notranslate"><span class="pre">os.environ[&quot;WDPA_KEY&quot;]=&quot;your_token&quot;</span></code> or
<a class="reference external" href="https://github.com/theskumar/python-dotenv">python-dotenv</a>.</p>
<p>The validity of your token can be checked with the function
<code class="docutils literal notranslate"><span class="pre">pywdpa.get_token()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># WDPA API</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="s2">&quot;.env&quot;</span><span class="p">)</span>
<span class="n">get_token</span><span class="p">()</span>
</pre></div>
</div>
<p>If your token is valid, the function will return its value. Otherwise
it will print an error message.</p>
</section>
</section>
</section>
<section id="data">
<h2>2 Data<a class="headerlink" href="#data" title="Permalink to this heading">¶</a></h2>
<section id="compute-forest-cover-change">
<h3>2.1 Compute forest cover change<a class="headerlink" href="#compute-forest-cover-change" title="Permalink to this heading">¶</a></h3>
<p>We specify the <a class="reference external" href="https://fr.wikipedia.org/wiki/ISO_3166-1#Table_de_codage">iso3</a> code of New Caledonia which is “NCL”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iso3</span> <span class="o">=</span> <span class="s2">&quot;NCL&quot;</span>
</pre></div>
</div>
<p>We compute the past forest cover change from Vancutsem et al. 2021
using Google Earth Engine. The argument <code class="docutils literal notranslate"><span class="pre">gdrive_remote_rclone</span></code> of the
function <a class="reference external" href="https://ecology.ghislainv.fr/forestatrisk/subpackages/forestatrisk.build_data.html#forestatrisk.build_data.data.country_forest_run">far.data.country_forest_run()</a> specifies the name of the
Google Drive remote for rclone. The argument <code class="docutils literal notranslate"><span class="pre">gdrive_folder</span></code> specifies
the name of the Google Drive folder to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute gee forest data</span>
<span class="n">far</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">country_forest_run</span><span class="p">(</span>
    <span class="n">iso3</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;data_raw&quot;</span><span class="p">,</span>
    <span class="n">keep_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fcc_source</span><span class="o">=</span><span class="s2">&quot;jrc&quot;</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">gdrive_remote_rclone</span><span class="o">=</span><span class="s2">&quot;gdrive_gv&quot;</span><span class="p">,</span>
    <span class="n">gdrive_folder</span><span class="o">=</span><span class="s2">&quot;GEE-forestatrisk-notebooks&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="download-raw-data">
<h3>2.2 Download raw data<a class="headerlink" href="#download-raw-data" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download data</span>
<span class="n">far</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">country_download</span><span class="p">(</span>
    <span class="n">iso3</span><span class="p">,</span>
    <span class="n">gdrive_remote_rclone</span><span class="o">=</span><span class="s2">&quot;gdrive_gv&quot;</span><span class="p">,</span>
    <span class="n">gdrive_folder</span><span class="o">=</span><span class="s2">&quot;GEE-forestatrisk-notebooks&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;data_raw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Downloading</span> <span class="n">data</span> <span class="k">for</span> <span class="n">country</span> <span class="n">NCL</span>
</pre></div>
</div>
</section>
<section id="compute-explanatory-variables">
<h3>2.3 Compute explanatory variables<a class="headerlink" href="#compute-explanatory-variables" title="Permalink to this heading">¶</a></h3>
<p>We first set the projection for New-Caledonia which is RGNC91-93 /
Lambert New Caledonia (<a class="reference external" href="https://epsg.io/3163">EPSG:3163</a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Projection</span>
<span class="n">proj</span> <span class="o">=</span> <span class="s2">&quot;EPSG:3163&quot;</span>
</pre></div>
</div>
<p>We compute the explanatory variables from the raw data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute variables</span>
<span class="n">far</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">country_compute</span><span class="p">(</span>
    <span class="n">iso3</span><span class="p">,</span>
    <span class="n">temp_dir</span><span class="o">=</span><span class="s2">&quot;data_raw&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
    <span class="n">data_country</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">data_forest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">keep_temp_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adding-data-on-ultramafic-soils">
<h3>2.4 Adding data on ultramafic soils<a class="headerlink" href="#adding-data-on-ultramafic-soils" title="Permalink to this heading">¶</a></h3>
<p>Data can be downloaded from <a class="reference external" href="https://georep-dtsi-sgt.opendata.arcgis.com/datasets/40d5b1a5afa244b1a73dd3620df075de_0/explore?location=-21.087852%2C165.489950%2C8.00">Géorep</a>. We unzip the shapefile in the
folder <code class="docutils literal notranslate"><span class="pre">gisdata/vectors/peridotite/</span></code>, reproject, and rasterize the
data at 30m.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">proj</span><span class="o">=</span><span class="s2">&quot;EPSG:3163&quot;</span>
<span class="nv">f1</span><span class="o">=</span><span class="s2">&quot;gisdata/vectors/peridotite/2de32d40-dc86-4bd9-9b83-420699bc672e2020413-1-13dmpoq.2hll.shp&quot;</span>
<span class="nv">f2</span><span class="o">=</span><span class="s2">&quot;gisdata/vectors/peridotite/geol_PROJ.shp&quot;</span>
ogr2ogr<span class="w"> </span>-overwrite<span class="w"> </span>-s_srs<span class="w"> </span>EPSG:4326<span class="w"> </span>-t_srs<span class="w"> </span><span class="nv">$proj</span><span class="w"> </span>-f<span class="w"> </span><span class="s1">&#39;ESRI Shapefile&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-lco<span class="w"> </span><span class="nv">ENCODING</span><span class="o">=</span>UTF-8<span class="w"> </span><span class="nv">$f2</span><span class="w"> </span><span class="nv">$f1</span>
</pre></div>
</div>
<p>We rasterize the polygon file using value 1 when on ultramafic soils
and 0 when not. Extent is obtained from file <code class="docutils literal notranslate"><span class="pre">pa.tif</span></code> with command
<code class="docutils literal notranslate"><span class="pre">gdalinfo</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>gdalinfo<span class="w"> </span>data/pa.tif
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Driver</span><span class="p">:</span> <span class="n">GTiff</span><span class="o">/</span><span class="n">GeoTIFF</span>
<span class="n">Files</span><span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">pa</span><span class="o">.</span><span class="n">tif</span>
<span class="n">Size</span> <span class="ow">is</span> <span class="mi">14296</span><span class="p">,</span> <span class="mi">12541</span>
<span class="n">Coordinate</span> <span class="n">System</span> <span class="ow">is</span><span class="p">:</span>
<span class="n">PROJCRS</span><span class="p">[</span><span class="s2">&quot;RGNC91-93 / Lambert New Caledonia&quot;</span><span class="p">,</span>
    <span class="n">BASEGEOGCRS</span><span class="p">[</span><span class="s2">&quot;RGNC91-93&quot;</span><span class="p">,</span>
        <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;Reseau Geodesique de Nouvelle Caledonie 91-93&quot;</span><span class="p">,</span>
            <span class="n">ELLIPSOID</span><span class="p">[</span><span class="s2">&quot;GRS 1980&quot;</span><span class="p">,</span><span class="mi">6378137</span><span class="p">,</span><span class="mf">298.257222101</span><span class="p">,</span>
                <span class="n">LENGTHUNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">]]],</span>
        <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ANGLEUNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]],</span>
        <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">4749</span><span class="p">]],</span>
    <span class="n">CONVERSION</span><span class="p">[</span><span class="s2">&quot;Lambert New Caledonia&quot;</span><span class="p">,</span>
        <span class="n">METHOD</span><span class="p">[</span><span class="s2">&quot;Lambert Conic Conformal (2SP)&quot;</span><span class="p">,</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">9802</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Latitude of false origin&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">21.5</span><span class="p">,</span>
            <span class="n">ANGLEUNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8821</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Longitude of false origin&quot;</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span>
            <span class="n">ANGLEUNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8822</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Latitude of 1st standard parallel&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">20.6666666666667</span><span class="p">,</span>
            <span class="n">ANGLEUNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8823</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Latitude of 2nd standard parallel&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">22.3333333333333</span><span class="p">,</span>
            <span class="n">ANGLEUNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8824</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Easting at false origin&quot;</span><span class="p">,</span><span class="mi">400000</span><span class="p">,</span>
            <span class="n">LENGTHUNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8826</span><span class="p">]],</span>
        <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;Northing at false origin&quot;</span><span class="p">,</span><span class="mi">300000</span><span class="p">,</span>
            <span class="n">LENGTHUNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">8827</span><span class="p">]]],</span>
    <span class="n">CS</span><span class="p">[</span><span class="n">Cartesian</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">AXIS</span><span class="p">[</span><span class="s2">&quot;easting (X)&quot;</span><span class="p">,</span><span class="n">east</span><span class="p">,</span>
            <span class="n">ORDER</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">LENGTHUNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">AXIS</span><span class="p">[</span><span class="s2">&quot;northing (Y)&quot;</span><span class="p">,</span><span class="n">north</span><span class="p">,</span>
            <span class="n">ORDER</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">LENGTHUNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
    <span class="n">USAGE</span><span class="p">[</span>
        <span class="n">SCOPE</span><span class="p">[</span><span class="s2">&quot;Engineering survey, topographic mapping.&quot;</span><span class="p">],</span>
        <span class="n">AREA</span><span class="p">[</span><span class="s2">&quot;New Caledonia - Belep, Grande Terre, Ile des Pins, Loyalty Islands (Lifou, Mare, Ouvea).&quot;</span><span class="p">],</span>
        <span class="n">BBOX</span><span class="p">[</span><span class="o">-</span><span class="mf">22.73</span><span class="p">,</span><span class="mf">163.54</span><span class="p">,</span><span class="o">-</span><span class="mf">19.5</span><span class="p">,</span><span class="mf">168.19</span><span class="p">]],</span>
    <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">3163</span><span class="p">]]</span>
<span class="n">Data</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">CRS</span> <span class="n">axis</span> <span class="n">mapping</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="n">Origin</span> <span class="o">=</span> <span class="p">(</span><span class="mf">139830.000000000000000</span><span class="p">,</span><span class="mf">521700.000000000000000</span><span class="p">)</span>
<span class="n">Pixel</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mf">30.000000000000000</span><span class="p">,</span><span class="o">-</span><span class="mf">30.000000000000000</span><span class="p">)</span>
<span class="n">Metadata</span><span class="p">:</span>
  <span class="n">AREA_OR_POINT</span><span class="o">=</span><span class="n">Area</span>
<span class="n">Image</span> <span class="n">Structure</span> <span class="n">Metadata</span><span class="p">:</span>
  <span class="n">COMPRESSION</span><span class="o">=</span><span class="n">LZW</span>
  <span class="n">INTERLEAVE</span><span class="o">=</span><span class="n">BAND</span>
<span class="n">Corner</span> <span class="n">Coordinates</span><span class="p">:</span>
<span class="n">Upper</span> <span class="n">Left</span>  <span class="p">(</span>  <span class="mf">139830.000</span><span class="p">,</span>  <span class="mf">521700.000</span><span class="p">)</span> <span class="p">(</span><span class="mi">163</span><span class="n">d31</span><span class="s1">&#39;22.97&quot;E, 19d28&#39;</span><span class="mf">44.64</span><span class="s2">&quot;S)</span>
<span class="n">Lower</span> <span class="n">Left</span>  <span class="p">(</span>  <span class="mf">139830.000</span><span class="p">,</span>  <span class="mf">145470.000</span><span class="p">)</span> <span class="p">(</span><span class="mi">163</span><span class="n">d27</span><span class="s1">&#39;53.88&quot;E, 22d52&#39;</span><span class="mf">35.34</span><span class="s2">&quot;S)</span>
<span class="n">Upper</span> <span class="n">Right</span> <span class="p">(</span>  <span class="mf">568710.000</span><span class="p">,</span>  <span class="mf">521700.000</span><span class="p">)</span> <span class="p">(</span><span class="mi">167</span><span class="n">d36</span><span class="s1">&#39;22.62&quot;E, 19d29&#39;</span><span class="mf">23.46</span><span class="s2">&quot;S)</span>
<span class="n">Lower</span> <span class="n">Right</span> <span class="p">(</span>  <span class="mf">568710.000</span><span class="p">,</span>  <span class="mf">145470.000</span><span class="p">)</span> <span class="p">(</span><span class="mi">167</span><span class="n">d38</span><span class="s1">&#39;38.23&quot;E, 22d53&#39;</span><span class="mf">15.07</span><span class="s2">&quot;S)</span>
<span class="n">Center</span>      <span class="p">(</span>  <span class="mf">354270.000</span><span class="p">,</span>  <span class="mf">333585.000</span><span class="p">)</span> <span class="p">(</span><span class="mi">165</span><span class="n">d33</span><span class="s1">&#39;34.36&quot;E, 21d11&#39;</span><span class="mf">45.81</span><span class="s2">&quot;S)</span>
<span class="n">Band</span> <span class="mi">1</span> <span class="n">Block</span><span class="o">=</span><span class="mi">14296</span><span class="n">x1</span> <span class="n">Type</span><span class="o">=</span><span class="n">Byte</span><span class="p">,</span> <span class="n">ColorInterp</span><span class="o">=</span><span class="n">Gray</span>
  <span class="n">NoData</span> <span class="n">Value</span><span class="o">=</span><span class="mi">255</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">proj</span><span class="o">=</span><span class="s2">&quot;EPSG:3163&quot;</span>
<span class="nv">f2</span><span class="o">=</span><span class="s2">&quot;gisdata/vectors/peridotite/geol_PROJ.shp&quot;</span>
<span class="nv">f3</span><span class="o">=</span><span class="s2">&quot;data/geol.tif&quot;</span>
gdal_rasterize<span class="w"> </span>-te<span class="w"> </span><span class="m">139830</span><span class="w"> </span><span class="m">145470</span><span class="w"> </span><span class="m">568710</span><span class="w"> </span><span class="m">521700</span><span class="w"> </span>-tap<span class="w"> </span>-burn<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">               </span>-co<span class="w"> </span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="w"> </span>-co<span class="w"> </span><span class="s2">&quot;PREDICTOR=2&quot;</span><span class="w"> </span>-co<span class="w"> </span><span class="s2">&quot;BIGTIFF=YES&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-init<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">               </span>-a_nodata<span class="w"> </span><span class="m">255</span><span class="w"> </span>-a_srs<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$proj</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-ot<span class="w"> </span>Byte<span class="w"> </span>-tr<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">30</span><span class="w"> </span>-l<span class="w"> </span>geol_PROJ<span class="w"> </span><span class="nv">$f2</span><span class="w"> </span><span class="nv">$f3</span>
</pre></div>
</div>
</section>
<section id="files">
<h3>2.5 Files<a class="headerlink" href="#files" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">data</span></code> folder includes:</p>
<ul class="simple">
<li><p>Forest cover change data for the period 2010-2020 as a GeoTiff raster
file (<code class="docutils literal notranslate"><span class="pre">data/fcc23.tif</span></code>).</p></li>
<li><p>Spatial explanatory variables as GeoTiff raster files (<code class="docutils literal notranslate"><span class="pre">.tif</span></code>
extension, eg. <code class="docutils literal notranslate"><span class="pre">data/dist_edge.tif</span></code> for distance to forest edge).</p></li>
<li><p>Additional folders: <code class="docutils literal notranslate"><span class="pre">forest</span></code>, <code class="docutils literal notranslate"><span class="pre">forecast</span></code>, and <code class="docutils literal notranslate"><span class="pre">emissions</span></code>, with forest
cover change for different periods of time, explanatory variables at
different dates used for projections in the future, and forest carbon
data for computing carbon emissions.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot forest</span>
<span class="n">fig_fcc23</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc</span><span class="p">(</span>
    <span class="n">input_fcc_raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/fcc23.png&quot;</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>Variable characteristics are summarized in the following table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Product</p></th>
<th class="head"><p>Source</p></th>
<th class="head"><p>Variable</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Resolution (m)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Forest maps (2000-2010-2020)</p></td>
<td><p>Vancutsem et al. 2021</p></td>
<td><p>distance to forest edge</p></td>
<td><p>m</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
<td><p>distance to past deforestation</p></td>
<td><p>m</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-even"><td><p>Digital Elevation Model</p></td>
<td><p>SRTM v4.1 CSI-CGIAR</p></td>
<td><p>altitude</p></td>
<td><p>m</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
<td><p>slope</p></td>
<td><p>degree</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-even"><td><p>Highways</p></td>
<td><p>OSM-Geofabrik</p></td>
<td><p>distance to roads</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-odd"><td><p>Places</p></td>
<td><p></p></td>
<td><p>distance to towns</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-even"><td><p>Waterways</p></td>
<td><p></p></td>
<td><p>distance to river</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-odd"><td><p>Protected areas</p></td>
<td><p>WDPA</p></td>
<td><p>protected area presence</p></td>
<td><p>–</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-even"><td><p>Geology</p></td>
<td><p>Géorep 1/50.000</p></td>
<td><p>peridotite bed presence</p></td>
<td><p>–</p></td>
<td><p>30</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="sampling">
<h2>3 Sampling<a class="headerlink" href="#sampling" title="Permalink to this heading">¶</a></h2>
<section id="sampling-the-observations">
<h3>3.1 Sampling the observations<a class="headerlink" href="#sampling-the-observations" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample points</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nsamp</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">adapt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">csize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                     <span class="n">var_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                     <span class="n">input_forest_raster</span><span class="o">=</span><span class="s2">&quot;fcc23.tif&quot;</span><span class="p">,</span>
                     <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/sample.txt&quot;</span><span class="p">,</span>
                     <span class="n">blk_rows</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Import data as pandas DataFrame if necessary</span>
<span class="c1"># dataset = pd.read_table(&quot;output/sample.txt&quot;, delimiter=&quot;,&quot;)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove NA from data-set (otherwise scale() and</span>
<span class="c1"># model_binomial_iCAR doesn&#39;t work)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Set number of trials to one for far.model_binomial_iCAR()</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;trial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Print the first five rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">altitude</span>  <span class="n">dist_defor</span>  <span class="n">dist_edge</span>  <span class="n">dist_river</span>  <span class="n">dist_road</span>  <span class="n">dist_town</span>  <span class="n">fcc23</span>  <span class="n">geol</span>   <span class="n">pa</span>  <span class="n">slope</span>         <span class="n">X</span>         <span class="n">Y</span>  <span class="n">cell</span>  <span class="n">trial</span>
<span class="mi">1</span>      <span class="mf">56.0</span>       <span class="mf">120.0</span>       <span class="mf">30.0</span>     <span class="mf">91747.0</span>    <span class="mf">19945.0</span>    <span class="mf">19860.0</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>  <span class="mf">1.0</span>   <span class="mf">10.0</span>  <span class="mf">145545.0</span>  <span class="mf">514875.0</span>   <span class="mf">0.0</span>      <span class="mi">1</span>
<span class="mi">2</span>      <span class="mf">35.0</span>       <span class="mf">162.0</span>       <span class="mf">30.0</span>     <span class="mf">89177.0</span>    <span class="mf">17328.0</span>    <span class="mf">17242.0</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>  <span class="mf">1.0</span>    <span class="mf">4.0</span>  <span class="mf">146595.0</span>  <span class="mf">512475.0</span>   <span class="mf">0.0</span>      <span class="mi">1</span>
<span class="mi">3</span>      <span class="mf">70.0</span>       <span class="mf">509.0</span>       <span class="mf">42.0</span>     <span class="mf">88256.0</span>    <span class="mf">16508.0</span>    <span class="mf">16417.0</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>  <span class="mf">1.0</span>   <span class="mf">11.0</span>  <span class="mf">147315.0</span>  <span class="mf">511875.0</span>   <span class="mf">0.0</span>      <span class="mi">1</span>
<span class="mi">4</span>      <span class="mf">74.0</span>       <span class="mf">488.0</span>       <span class="mf">60.0</span>     <span class="mf">90900.0</span>    <span class="mf">18870.0</span>    <span class="mf">18795.0</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>  <span class="mf">0.0</span>   <span class="mf">15.0</span>  <span class="mf">145095.0</span>  <span class="mf">513525.0</span>   <span class="mf">0.0</span>      <span class="mi">1</span>
<span class="mi">5</span>      <span class="mf">66.0</span>       <span class="mf">210.0</span>       <span class="mf">67.0</span>     <span class="mf">89386.0</span>    <span class="mf">17522.0</span>    <span class="mf">17437.0</span>    <span class="mf">0.0</span>   <span class="mf">1.0</span>  <span class="mf">1.0</span>   <span class="mf">13.0</span>  <span class="mf">146445.0</span>  <span class="mf">512685.0</span>   <span class="mf">0.0</span>      <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample size</span>
<span class="n">ndefor</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">fcc23</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">nfor</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">fcc23</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/sample_size.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;var, n</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ndefor, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ndefor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;nfor, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nfor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ndefor = </span><span class="si">{}</span><span class="s2">, nfor = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ndefor</span><span class="p">,</span> <span class="n">nfor</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ndefor</span> <span class="o">=</span> <span class="mi">9933</span><span class="p">,</span> <span class="n">nfor</span> <span class="o">=</span> <span class="mi">9977</span>
</pre></div>
</div>
</section>
<section id="correlation-plots">
<h3>3.2 Correlation plots<a class="headerlink" href="#correlation-plots" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlation formula</span>
<span class="n">formula_corr</span> <span class="o">=</span> <span class="s2">&quot;fcc23 ~ dist_road + dist_town + dist_river + </span><span class="se">\</span>
<span class="s2">dist_defor + dist_edge + altitude + slope - 1&quot;</span>

<span class="c1"># Output file</span>
<span class="n">of</span> <span class="o">=</span> <span class="s2">&quot;output/correlation.pdf&quot;</span>
<span class="c1"># Data</span>
<span class="n">y</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_corr</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
                    <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>
<span class="c1"># Plots</span>
<span class="n">figs</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">plots_per_page</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">of</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="model">
<h2>4 Model<a class="headerlink" href="#model" title="Permalink to this heading">¶</a></h2>
<section id="model-preparation">
<h3>4.1 Model preparation<a class="headerlink" href="#model-preparation" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Neighborhood for spatial-autocorrelation</span>
<span class="n">nneigh</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">cellneigh</span><span class="p">(</span><span class="n">raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span> <span class="n">csize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># List of variables</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C(pa)&quot;</span><span class="p">,</span> <span class="s2">&quot;C(geol)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(altitude)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(slope)&quot;</span><span class="p">,</span>
             <span class="s2">&quot;scale(dist_defor)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(dist_edge)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(dist_road)&quot;</span><span class="p">,</span>
             <span class="s2">&quot;scale(dist_town)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(dist_river)&quot;</span><span class="p">]</span>
<span class="c1"># Transform into numpy array</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

<span class="c1"># Starting values</span>
<span class="n">beta_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>  <span class="c1"># Simple GLM estimates</span>
<span class="c1"># Priors</span>
<span class="n">priorVrho</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># -1=&quot;1/Gamma&quot;</span>
</pre></div>
</div>
</section>
<section id="variable-selection">
<h3>4.2 Variable selection<a class="headerlink" href="#variable-selection" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Formula</span>
<span class="n">right_part</span> <span class="o">=</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; + cell&quot;</span>
<span class="n">left_part</span> <span class="o">=</span> <span class="s2">&quot;I(1-fcc23) + trial ~ &quot;</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">left_part</span> <span class="o">+</span> <span class="n">right_part</span>
<span class="c1"># Model</span>
<span class="n">mod_binomial_iCAR</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">model_binomial_iCAR</span><span class="p">(</span>
  <span class="c1"># Observations</span>
  <span class="n">suitability_formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
  <span class="c1"># Spatial structure</span>
  <span class="n">n_neighbors</span><span class="o">=</span><span class="n">nneigh</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="n">adj</span><span class="p">,</span>
  <span class="c1"># Priors</span>
  <span class="n">priorVrho</span><span class="o">=</span><span class="n">priorVrho</span><span class="p">,</span>
  <span class="c1"># Chains</span>
  <span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mcmc</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="c1"># Starting values</span>
  <span class="n">beta_start</span><span class="o">=</span><span class="n">beta_start</span><span class="p">)</span>
</pre></div>
</div>
<p>We check the parameter values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mod_binomial_iCAR</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Binomial</span> <span class="n">logistic</span> <span class="n">regression</span> <span class="k">with</span> <span class="n">iCAR</span> <span class="n">process</span>
  <span class="n">Model</span><span class="p">:</span> <span class="n">I</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fcc23</span><span class="p">)</span> <span class="o">+</span> <span class="n">trial</span> <span class="o">~</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">C</span><span class="p">(</span><span class="n">pa</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="p">(</span><span class="n">geol</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_defor</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_edge</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_road</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_town</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_river</span><span class="p">)</span> <span class="o">+</span> <span class="n">cell</span>
  <span class="n">Posteriors</span><span class="p">:</span>
                        <span class="n">Mean</span>        <span class="n">Std</span>     <span class="n">CI_low</span>    <span class="n">CI_high</span>
        <span class="n">Intercept</span>      <span class="o">-</span><span class="mf">1.88</span>      <span class="mf">0.117</span>      <span class="o">-</span><span class="mf">2.13</span>      <span class="o">-</span><span class="mf">1.65</span>
     <span class="n">C</span><span class="p">(</span><span class="n">pa</span><span class="p">)[</span><span class="n">T</span><span class="mf">.1.0</span><span class="p">]</span>     <span class="mf">0.0479</span>     <span class="mf">0.0814</span>     <span class="o">-</span><span class="mf">0.111</span>      <span class="mf">0.212</span>
   <span class="n">C</span><span class="p">(</span><span class="n">geol</span><span class="p">)[</span><span class="n">T</span><span class="mf">.1.0</span><span class="p">]</span>      <span class="mf">0.358</span>     <span class="mf">0.0683</span>      <span class="mf">0.222</span>      <span class="mf">0.484</span>
  <span class="n">scale</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.253</span>     <span class="mf">0.0301</span>     <span class="o">-</span><span class="mf">0.316</span>     <span class="o">-</span><span class="mf">0.196</span>
     <span class="n">scale</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.114</span>     <span class="mf">0.0258</span>     <span class="o">-</span><span class="mf">0.164</span>     <span class="o">-</span><span class="mf">0.065</span>
<span class="n">scale</span><span class="p">(</span><span class="n">dist_defor</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.827</span>     <span class="mf">0.0433</span>      <span class="o">-</span><span class="mf">0.92</span>     <span class="o">-</span><span class="mf">0.745</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_edge</span><span class="p">)</span>      <span class="o">-</span><span class="mf">6.03</span>      <span class="mf">0.216</span>      <span class="o">-</span><span class="mf">6.46</span>      <span class="o">-</span><span class="mf">5.63</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_road</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.111</span>     <span class="mf">0.0402</span>     <span class="o">-</span><span class="mf">0.183</span>    <span class="o">-</span><span class="mf">0.0193</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_town</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.121</span>     <span class="mf">0.0281</span>      <span class="o">-</span><span class="mf">0.18</span>    <span class="o">-</span><span class="mf">0.0713</span>
<span class="n">scale</span><span class="p">(</span><span class="n">dist_river</span><span class="p">)</span>    <span class="o">-</span><span class="mf">0.0556</span>      <span class="mf">0.129</span>     <span class="o">-</span><span class="mf">0.298</span>       <span class="mf">0.16</span>
             <span class="n">Vrho</span>       <span class="mf">2.92</span>      <span class="mf">0.315</span>       <span class="mf">2.34</span>       <span class="mf">3.59</span>
         <span class="n">Deviance</span>   <span class="mf">1.61e+04</span>       <span class="mf">22.1</span>   <span class="mf">1.61e+04</span>   <span class="mf">1.62e+04</span>
</pre></div>
</div>
</section>
<section id="final-model">
<h3>4.3 Final model<a class="headerlink" href="#final-model" title="Permalink to this heading">¶</a></h3>
<p>We remove the protected areas and the distance to river from the list
of explanatory variables as their effects seem not to be significant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Formula</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C(geol)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(altitude)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(slope)&quot;</span><span class="p">,</span>
             <span class="s2">&quot;scale(dist_defor)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(dist_edge)&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(dist_road)&quot;</span><span class="p">,</span>
             <span class="s2">&quot;scale(dist_town)&quot;</span><span class="p">]</span>
<span class="n">right_part</span> <span class="o">=</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; + cell&quot;</span>
<span class="n">left_part</span> <span class="o">=</span> <span class="s2">&quot;I(1-fcc23) + trial ~ &quot;</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">left_part</span> <span class="o">+</span> <span class="n">right_part</span>
<span class="c1"># Re-run the model with longer MCMC and estimated initial values</span>
<span class="n">mod_binomial_iCAR</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">model_binomial_iCAR</span><span class="p">(</span>
  <span class="c1"># Observations</span>
  <span class="n">suitability_formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
  <span class="c1"># Spatial structure</span>
  <span class="n">n_neighbors</span><span class="o">=</span><span class="n">nneigh</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="n">adj</span><span class="p">,</span>
  <span class="c1"># Priors</span>
  <span class="n">priorVrho</span><span class="o">=</span><span class="n">priorVrho</span><span class="p">,</span>
  <span class="c1"># Chains</span>
  <span class="n">burnin</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">mcmc</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="c1"># Starting values</span>
  <span class="n">beta_start</span><span class="o">=</span><span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">betas</span><span class="p">)</span>
</pre></div>
</div>
<p>We can plot the traces of the MCMCs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">figs</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
  <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/mcmc.pdf&quot;</span><span class="p">,</span><span class="n">plots_per_page</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
  <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>We save the model using pickle.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save model&#39;s main specifications with pickle</span>
<span class="n">mod_icar_pickle</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;formula&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">suitability_formula</span><span class="p">,</span>
  <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span>
  <span class="s2">&quot;betas&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">betas</span><span class="p">,</span>
  <span class="s2">&quot;Vrho&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">Vrho</span><span class="p">,</span>
  <span class="s2">&quot;deviance&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">deviance</span><span class="p">}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/mod_icar.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pickle_file</span><span class="p">:</span>
  <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">mod_icar_pickle</span><span class="p">,</span> <span class="n">pickle_file</span><span class="p">)</span>
</pre></div>
</div>
<p>We get model’s predictions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predictions</span>
<span class="n">pred_icar</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">theta_pred</span>
</pre></div>
</div>
</section>
</section>
<section id="model-comparison-and-validation">
<h2>5 Model comparison and validation<a class="headerlink" href="#model-comparison-and-validation" title="Permalink to this heading">¶</a></h2>
<section id="cross-validation">
<h3>5.1 Cross-validation<a class="headerlink" href="#cross-validation" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cross-validation for icar, glm and RF</span>
<span class="n">CV_df_icar</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">(</span>
  <span class="n">dataset</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="s2">&quot;icar&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">nrep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">icar_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_neighbors&quot;</span><span class="p">:</span> <span class="n">nneigh</span><span class="p">,</span> <span class="s2">&quot;neighbors&quot;</span><span class="p">:</span> <span class="n">adj</span><span class="p">,</span>
         <span class="s2">&quot;burnin&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;mcmc&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;thin&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;beta_start&quot;</span><span class="p">:</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">betas</span><span class="p">})</span>

<span class="n">CV_df_glm</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="s2">&quot;glm&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">nrep</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">CV_df_rf</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">mod_type</span><span class="o">=</span><span class="s2">&quot;rf&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">nrep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">rf_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Save result to disk</span>
<span class="n">CV_df_icar</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;output/CV_icar.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">CV_df_glm</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;output/CV_glm.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">CV_df_rf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;output/CV_rf.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">CV_df_icar</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">index</span>    <span class="n">rep1</span>    <span class="n">rep2</span>    <span class="n">rep3</span>    <span class="n">rep4</span>    <span class="n">rep5</span>    <span class="n">mean</span>
<span class="mi">0</span>   <span class="n">AUC</span>  <span class="mf">0.8817</span>  <span class="mf">0.8854</span>  <span class="mf">0.8856</span>  <span class="mf">0.8916</span>  <span class="mf">0.8901</span>  <span class="mf">0.8869</span>
<span class="mi">1</span>    <span class="n">OA</span>  <span class="mf">0.8024</span>  <span class="mf">0.8048</span>  <span class="mf">0.8041</span>  <span class="mf">0.8135</span>  <span class="mf">0.8091</span>  <span class="mf">0.8068</span>
<span class="mi">2</span>    <span class="n">EA</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>
<span class="mi">3</span>   <span class="n">FOM</span>  <span class="mf">0.6701</span>  <span class="mf">0.6689</span>  <span class="mf">0.6732</span>  <span class="mf">0.6895</span>  <span class="mf">0.6808</span>  <span class="mf">0.6765</span>
<span class="mi">4</span>   <span class="n">Sen</span>  <span class="mf">0.8025</span>  <span class="mf">0.8016</span>  <span class="mf">0.8047</span>  <span class="mf">0.8162</span>  <span class="mf">0.8101</span>  <span class="mf">0.8070</span>
<span class="mi">5</span>   <span class="n">Spe</span>  <span class="mf">0.8024</span>  <span class="mf">0.8078</span>  <span class="mf">0.8036</span>  <span class="mf">0.8107</span>  <span class="mf">0.8082</span>  <span class="mf">0.8065</span>
<span class="mi">6</span>   <span class="n">TSS</span>  <span class="mf">0.6049</span>  <span class="mf">0.6095</span>  <span class="mf">0.6082</span>  <span class="mf">0.6269</span>  <span class="mf">0.6183</span>  <span class="mf">0.6136</span>
<span class="mi">7</span>     <span class="n">K</span>  <span class="mf">0.6049</span>  <span class="mf">0.6095</span>  <span class="mf">0.6082</span>  <span class="mf">0.6269</span>  <span class="mf">0.6183</span>  <span class="mf">0.6136</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">CV_df_glm</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">index</span>    <span class="n">rep1</span>    <span class="n">rep2</span>    <span class="n">rep3</span>    <span class="n">rep4</span>    <span class="n">rep5</span>    <span class="n">mean</span>
<span class="mi">0</span>   <span class="n">AUC</span>  <span class="mf">0.8512</span>  <span class="mf">0.8584</span>  <span class="mf">0.8524</span>  <span class="mf">0.8612</span>  <span class="mf">0.8582</span>  <span class="mf">0.8563</span>
<span class="mi">1</span>    <span class="n">OA</span>  <span class="mf">0.7706</span>  <span class="mf">0.7783</span>  <span class="mf">0.7683</span>  <span class="mf">0.7787</span>  <span class="mf">0.7757</span>  <span class="mf">0.7743</span>
<span class="mi">2</span>    <span class="n">EA</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>  <span class="mf">0.5000</span>  <span class="mf">0.5001</span>
<span class="mi">3</span>   <span class="n">FOM</span>  <span class="mf">0.6269</span>  <span class="mf">0.6323</span>  <span class="mf">0.6246</span>  <span class="mf">0.6419</span>  <span class="mf">0.6350</span>  <span class="mf">0.6322</span>
<span class="mi">4</span>   <span class="n">Sen</span>  <span class="mf">0.7707</span>  <span class="mf">0.7748</span>  <span class="mf">0.7689</span>  <span class="mf">0.7819</span>  <span class="mf">0.7767</span>  <span class="mf">0.7746</span>
<span class="mi">5</span>   <span class="n">Spe</span>  <span class="mf">0.7706</span>  <span class="mf">0.7818</span>  <span class="mf">0.7676</span>  <span class="mf">0.7753</span>  <span class="mf">0.7746</span>  <span class="mf">0.7740</span>
<span class="mi">6</span>   <span class="n">TSS</span>  <span class="mf">0.5413</span>  <span class="mf">0.5566</span>  <span class="mf">0.5366</span>  <span class="mf">0.5572</span>  <span class="mf">0.5513</span>  <span class="mf">0.5486</span>
<span class="mi">7</span>     <span class="n">K</span>  <span class="mf">0.5413</span>  <span class="mf">0.5566</span>  <span class="mf">0.5366</span>  <span class="mf">0.5572</span>  <span class="mf">0.5513</span>  <span class="mf">0.5486</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">CV_df_rf</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">index</span>    <span class="n">rep1</span>    <span class="n">rep2</span>    <span class="n">rep3</span>    <span class="n">rep4</span>    <span class="n">rep5</span>    <span class="n">mean</span>
<span class="mi">0</span>   <span class="n">AUC</span>  <span class="mf">0.8720</span>  <span class="mf">0.8761</span>  <span class="mf">0.8849</span>  <span class="mf">0.8818</span>  <span class="mf">0.8709</span>  <span class="mf">0.8771</span>
<span class="mi">1</span>    <span class="n">OA</span>  <span class="mf">0.7901</span>  <span class="mf">0.7949</span>  <span class="mf">0.8009</span>  <span class="mf">0.8011</span>  <span class="mf">0.7911</span>  <span class="mf">0.7956</span>
<span class="mi">2</span>    <span class="n">EA</span>  <span class="mf">0.5000</span>  <span class="mf">0.5002</span>  <span class="mf">0.5001</span>  <span class="mf">0.5000</span>  <span class="mf">0.5000</span>  <span class="mf">0.5000</span>
<span class="mi">3</span>   <span class="n">FOM</span>  <span class="mf">0.6527</span>  <span class="mf">0.6542</span>  <span class="mf">0.6708</span>  <span class="mf">0.6696</span>  <span class="mf">0.6535</span>  <span class="mf">0.6602</span>
<span class="mi">4</span>   <span class="n">Sen</span>  <span class="mf">0.7907</span>  <span class="mf">0.7911</span>  <span class="mf">0.8034</span>  <span class="mf">0.8029</span>  <span class="mf">0.7905</span>  <span class="mf">0.7957</span>
<span class="mi">5</span>   <span class="n">Spe</span>  <span class="mf">0.7894</span>  <span class="mf">0.7986</span>  <span class="mf">0.7984</span>  <span class="mf">0.7993</span>  <span class="mf">0.7917</span>  <span class="mf">0.7955</span>
<span class="mi">6</span>   <span class="n">TSS</span>  <span class="mf">0.5801</span>  <span class="mf">0.5897</span>  <span class="mf">0.6018</span>  <span class="mf">0.6022</span>  <span class="mf">0.5821</span>  <span class="mf">0.5912</span>
<span class="mi">7</span>     <span class="n">K</span>  <span class="mf">0.5801</span>  <span class="mf">0.5897</span>  <span class="mf">0.6018</span>  <span class="mf">0.6022</span>  <span class="mf">0.5821</span>  <span class="mf">0.5912</span>
</pre></div>
</div>
<p>The “icar” model has the best accuracy indices for the cross-validation.</p>
</section>
<section id="deviance">
<h3>5.2 Deviance<a class="headerlink" href="#deviance" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Null model</span>
<span class="n">formula_null</span> <span class="o">=</span> <span class="s2">&quot;I(1-fcc23) ~ 1&quot;</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_null</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">NA_action</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_null</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:]</span>
<span class="n">mod_null</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s2">&quot;lbfgs&quot;</span><span class="p">)</span>
<span class="n">mod_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_null</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">pred_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_null</span><span class="p">)</span>

<span class="c1"># Simple glm with no spatial random effects</span>
<span class="n">formula_glm</span> <span class="o">=</span> <span class="n">formula</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_glm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">NA_action</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_glm</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># We remove the last column (cells)</span>
<span class="n">mod_glm</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s2">&quot;lbfgs&quot;</span><span class="p">)</span>
<span class="n">mod_glm</span> <span class="o">=</span> <span class="n">mod_glm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_glm</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">pred_glm</span> <span class="o">=</span> <span class="n">mod_glm</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_glm</span><span class="p">)</span>

<span class="c1"># Random forest model</span>
<span class="n">formula_rf</span> <span class="o">=</span> <span class="n">formula</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_rf</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">NA_action</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_rf</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># We remove the last column (cells)</span>
<span class="n">mod_rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">mod_rf</span> <span class="o">=</span> <span class="n">mod_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_rf</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">pred_rf</span> <span class="o">=</span> <span class="n">mod_rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_rf</span><span class="p">)</span>

<span class="c1"># Deviances</span>
<span class="n">deviance_null</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">log_loss</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">pred_null</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">deviance_glm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">log_loss</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">pred_glm</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">deviance_rf</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">log_loss</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">pred_rf</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">deviance_icar</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">deviance</span>
<span class="n">deviance_full</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dev</span> <span class="o">=</span> <span class="p">[</span><span class="n">deviance_null</span><span class="p">,</span> <span class="n">deviance_glm</span><span class="p">,</span> <span class="n">deviance_rf</span><span class="p">,</span> <span class="n">deviance_icar</span><span class="p">,</span> <span class="n">deviance_full</span><span class="p">]</span>

<span class="c1"># Result table</span>
<span class="n">mod_dev</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;glm&quot;</span><span class="p">,</span> <span class="s2">&quot;rf&quot;</span><span class="p">,</span> <span class="s2">&quot;icar&quot;</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">],</span>
                  <span class="s2">&quot;deviance&quot;</span><span class="p">:</span> <span class="n">dev</span><span class="p">})</span>
<span class="n">perc</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mod_dev</span><span class="o">.</span><span class="n">deviance</span><span class="o">/</span><span class="n">deviance_null</span><span class="p">)</span>
<span class="n">mod_dev</span><span class="p">[</span><span class="s2">&quot;perc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">perc</span>
<span class="n">mod_dev</span> <span class="o">=</span> <span class="n">mod_dev</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mod_dev</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;output/model_deviance.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mod_dev</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span>  <span class="n">deviance</span>   <span class="n">perc</span>
<span class="mi">0</span>  <span class="n">null</span>   <span class="mf">27600.0</span>    <span class="mf">0.0</span>
<span class="mi">1</span>   <span class="n">glm</span>   <span class="mf">18301.0</span>   <span class="mf">34.0</span>
<span class="mi">2</span>    <span class="n">rf</span>    <span class="mf">4385.0</span>   <span class="mf">84.0</span>
<span class="mi">3</span>  <span class="n">icar</span>   <span class="mf">16109.0</span>   <span class="mf">42.0</span>
<span class="mi">4</span>  <span class="n">full</span>       <span class="mf">0.0</span>  <span class="mf">100.0</span>
</pre></div>
</div>
<p>While the “rf” had lower accuracy indices than the “icar” model for the cross-validation, the “rf” model explains 84% of the deviance against 42% for the “icar” model. This shows clearly that the “rf” model overfits the data. Moreover, the “glm” explains only 34% of the deviance. This means that fixed variables included in the model only explain a part of the spatial variability in the deforestation process and that adding spatial random effects allow to structure a significant part of the residual variability (8%). We thus use the “icar” model to predict the spatial location of the deforestation in the future.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save models&#39; predictions</span>
<span class="n">obs_pred</span> <span class="o">=</span> <span class="n">dataset</span>
<span class="n">obs_pred</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_null</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">obs_pred</span><span class="p">[</span><span class="s2">&quot;glm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_glm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">obs_pred</span><span class="p">[</span><span class="s2">&quot;rf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_rf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">obs_pred</span><span class="p">[</span><span class="s2">&quot;icar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_icar</span>
<span class="n">obs_pred</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;output/obs_pred.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="variables-effects">
<h2>6 Variables’ effects<a class="headerlink" href="#variables-effects" title="Permalink to this heading">¶</a></h2>
<section id="models-coefficients">
<h3>6.1 Model’s coefficients<a class="headerlink" href="#models-coefficients" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mod_binomial_iCAR</span><span class="p">)</span>
<span class="c1"># Write summary in file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/summary_hSDM.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mod_binomial_iCAR</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Binomial</span> <span class="n">logistic</span> <span class="n">regression</span> <span class="k">with</span> <span class="n">iCAR</span> <span class="n">process</span>
  <span class="n">Model</span><span class="p">:</span> <span class="n">I</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fcc23</span><span class="p">)</span> <span class="o">+</span> <span class="n">trial</span> <span class="o">~</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">C</span><span class="p">(</span><span class="n">geol</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_defor</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_edge</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_road</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale</span><span class="p">(</span><span class="n">dist_town</span><span class="p">)</span> <span class="o">+</span> <span class="n">cell</span>
  <span class="n">Posteriors</span><span class="p">:</span>
                        <span class="n">Mean</span>        <span class="n">Std</span>     <span class="n">CI_low</span>    <span class="n">CI_high</span>
        <span class="n">Intercept</span>      <span class="o">-</span><span class="mf">1.85</span>      <span class="mf">0.183</span>      <span class="o">-</span><span class="mf">2.18</span>      <span class="o">-</span><span class="mf">1.45</span>
   <span class="n">C</span><span class="p">(</span><span class="n">geol</span><span class="p">)[</span><span class="n">T</span><span class="mf">.1.0</span><span class="p">]</span>      <span class="mf">0.349</span>     <span class="mf">0.0758</span>      <span class="mf">0.194</span>      <span class="mf">0.489</span>
  <span class="n">scale</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.258</span>     <span class="mf">0.0343</span>     <span class="o">-</span><span class="mf">0.324</span>     <span class="o">-</span><span class="mf">0.187</span>
     <span class="n">scale</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.108</span>     <span class="mf">0.0265</span>     <span class="o">-</span><span class="mf">0.158</span>    <span class="o">-</span><span class="mf">0.0585</span>
<span class="n">scale</span><span class="p">(</span><span class="n">dist_defor</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.822</span>     <span class="mf">0.0453</span>     <span class="o">-</span><span class="mf">0.909</span>     <span class="o">-</span><span class="mf">0.739</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_edge</span><span class="p">)</span>      <span class="o">-</span><span class="mf">6.11</span>      <span class="mf">0.187</span>      <span class="o">-</span><span class="mf">6.47</span>      <span class="o">-</span><span class="mf">5.78</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_road</span><span class="p">)</span>     <span class="o">-</span><span class="mf">0.106</span>     <span class="mf">0.0446</span>     <span class="o">-</span><span class="mf">0.202</span>    <span class="o">-</span><span class="mf">0.0246</span>
 <span class="n">scale</span><span class="p">(</span><span class="n">dist_town</span><span class="p">)</span>      <span class="o">-</span><span class="mf">0.13</span>     <span class="mf">0.0474</span>     <span class="o">-</span><span class="mf">0.221</span>    <span class="o">-</span><span class="mf">0.0372</span>
             <span class="n">Vrho</span>       <span class="mf">2.91</span>      <span class="mf">0.364</span>       <span class="mf">2.23</span>       <span class="mf">3.63</span>
         <span class="n">Deviance</span>   <span class="mf">1.61e+04</span>       <span class="mf">22.6</span>   <span class="mf">1.61e+04</span>   <span class="mf">1.62e+04</span>
</pre></div>
</div>
<p>Results show that deforestation probability is significantly higher
for forest located on ultramafic soils. This can be explained
considering different hypothesis. First, mines are located on
ultramafic soils so it could be that deforestation is higher on this
soil type because of mining activities and mine extensions. Second, it
could be that the vegetation on ultramafic soil is more susceptible to
fires. Third, a confounding factor (correlated to ultramafic soils),
could explain the higher deforestation probability on this soil
type. It could be that human activities inducing deforestation
(agriculture, pasture) are more developed in the southern part of
New-Caledonia, where the ultramafic soils are more present.</p>
</section>
<section id="effect-of-the-distances-to-road-and-forest-edge">
<h3>6.2 Effect of the distances to road and forest edge<a class="headerlink" href="#effect-of-the-distances-to-road-and-forest-edge" title="Permalink to this heading">¶</a></h3>
<p>We define an inverse-logit function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inverse-logit function</span>
<span class="k">def</span> <span class="nf">inv_logit</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variable transformation</span>
<span class="n">sd_road</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;dist_road&quot;</span><span class="p">])</span> <span class="c1"># dist in meter</span>
<span class="c1"># Effect of roads at decreasing deforestation probability</span>
<span class="n">alpha_normalized</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.85</span>
<span class="n">coef_road_km</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.106</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="n">sd_road</span> <span class="c1"># Back-transformed parameter to have slope in km^-1</span>
<span class="n">theta_mean</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span><span class="p">)</span> <span class="c1"># Mean deforestation probability</span>
<span class="n">theta_road_1km</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span> <span class="o">+</span> <span class="n">coef_road_km</span><span class="p">)</span>
<span class="n">d_road_1km</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">theta_road_1km</span><span class="o">/</span><span class="n">theta_mean</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">theta_road_10km</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span> <span class="o">+</span> <span class="n">coef_road_km</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="n">d_road_10km</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">theta_road_10km</span><span class="o">/</span><span class="n">theta_mean</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Print results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d_road_1km: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_road_1km</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d_road_10km: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_road_10km</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d_road_1km</span><span class="p">:</span> <span class="mf">2.0</span><span class="o">%</span>
<span class="n">d_road_10km</span><span class="p">:</span> <span class="mf">18.0</span><span class="o">%</span>
</pre></div>
</div>
<p>On average, a distance of 10 km from a road reduces the risk of
deforestation by 18%.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variable transformation</span>
<span class="n">sd_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;dist_edge&quot;</span><span class="p">])</span> <span class="c1"># dist in meter</span>
<span class="c1">## Effect of edges at decreasing deforestation probability</span>
<span class="n">alpha_normalized</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.85</span>
<span class="n">coef_edge_km</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.11</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="n">sd_edge</span> <span class="c1"># Back-transformed parameter to have slope in km^-1</span>
<span class="n">theta_mean</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span><span class="p">)</span> <span class="c1"># Mean deforestation probability</span>
<span class="n">theta_edge_100m</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span> <span class="o">+</span> <span class="n">coef_edge_km</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">d_edge_100m</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">theta_edge_100m</span><span class="o">/</span><span class="n">theta_mean</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">theta_edge_1km</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span> <span class="o">+</span> <span class="n">coef_edge_km</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d_edge_1km</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">theta_edge_1km</span><span class="o">/</span><span class="n">theta_mean</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Print results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d_edge_100m: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_edge_100m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d_edge_1km: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_edge_10km</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d_edge_100m</span><span class="p">:</span> <span class="mf">95.0</span><span class="o">%</span>
<span class="n">d_edge_1km</span><span class="p">:</span> <span class="mf">100.0</span><span class="o">%</span>
</pre></div>
</div>
<p>On average, a distance of 100 m from the forest edge reduces the risk
of deforestation by 95%, and a distance of 1 km reduces the risk of
deforestation by almost 100%.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;output/obs_pred.csv&quot;</span><span class="p">)</span>

<span class="c1"># Percentiles</span>
<span class="n">perc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">nperc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span>

<span class="c1"># Result table with local means for each variable</span>
<span class="n">theta_lmean</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Compute theta and se by bins</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;fcc23&quot;</span><span class="p">]</span>  <span class="c1"># Transform: defor=1, forest=0</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;dist_road_km&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;dist_road&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;dist_edge_km&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;dist_edge&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="n">varname</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dist_road_km&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_edge_km&quot;</span><span class="p">]</span>

<span class="c1"># Loop on variables</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varname</span><span class="p">)):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nperc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nperc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nperc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">perc</span><span class="p">)</span>
    <span class="c1"># Model icar</span>
    <span class="n">theta_icar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;icar&quot;</span><span class="p">]</span>
    <span class="n">theta_icar_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nperc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Compute theta and se by bins</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nperc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">inf</span> <span class="o">=</span> <span class="n">quantiles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">sup</span> <span class="o">=</span> <span class="n">quantiles</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">inf</span> <span class="o">+</span> <span class="p">(</span><span class="n">sup</span> <span class="o">-</span> <span class="n">inf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># Observations in bin</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">inf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sup</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">nperc</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">inf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sup</span><span class="p">)</span>
        <span class="n">y_bin</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">y_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_bin</span><span class="p">)</span>  <span class="c1"># Transform into np.array to compute sum</span>
        <span class="c1"># Local mean and se</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y_bin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># success</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_bin</span><span class="p">)</span>  <span class="c1"># trials</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">se</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ph</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># icar</span>
        <span class="n">t_bin</span> <span class="o">=</span> <span class="n">theta_icar</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">theta_icar_mean</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t_bin</span><span class="p">)</span>
    <span class="c1"># Fill the list</span>
    <span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                           <span class="s2">&quot;theta_obs&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">,</span>
                           <span class="s2">&quot;theta_icar&quot;</span><span class="p">:</span> <span class="n">theta_icar_mean</span><span class="p">})</span>
    <span class="n">theta_lmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_out</span><span class="p">)</span>
<span class="c1"># DataFrame per variable</span>
<span class="n">theta_road</span> <span class="o">=</span> <span class="n">theta_lmean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">theta_edge</span> <span class="o">=</span> <span class="n">theta_lmean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">theta_road</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">theta_edge</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>  <span class="n">theta_obs</span>  <span class="n">theta_icar</span>
<span class="mi">0</span>   <span class="mf">0.2250</span>   <span class="mf">0.729167</span>    <span class="mf">0.696619</span>
<span class="mi">1</span>   <span class="mf">0.7555</span>   <span class="mf">0.656746</span>    <span class="mf">0.643098</span>
<span class="mi">2</span>   <span class="mf">1.4085</span>   <span class="mf">0.613300</span>    <span class="mf">0.602317</span>
<span class="mi">3</span>   <span class="mf">2.1880</span>   <span class="mf">0.512024</span>    <span class="mf">0.526354</span>
<span class="mi">4</span>   <span class="mf">3.1240</span>   <span class="mf">0.477354</span>    <span class="mf">0.485228</span>
<span class="mi">5</span>   <span class="mf">4.2660</span>   <span class="mf">0.399504</span>    <span class="mf">0.427308</span>
<span class="mi">6</span>   <span class="mf">5.6725</span>   <span class="mf">0.388749</span>    <span class="mf">0.411547</span>
<span class="mi">7</span>   <span class="mf">7.4185</span>   <span class="mf">0.404726</span>    <span class="mf">0.398200</span>
<span class="mi">8</span>   <span class="mf">9.9100</span>   <span class="mf">0.377444</span>    <span class="mf">0.377488</span>
<span class="mi">9</span>  <span class="mf">25.5895</span>   <span class="mf">0.434673</span>    <span class="mf">0.423524</span>
        <span class="n">x</span>  <span class="n">theta_obs</span>  <span class="n">theta_icar</span>
<span class="mi">0</span>  <span class="mf">0.0300</span>        <span class="n">NaN</span>         <span class="n">NaN</span>
<span class="mi">1</span>  <span class="mf">0.0300</span>        <span class="n">NaN</span>         <span class="n">NaN</span>
<span class="mi">2</span>  <span class="mf">0.0300</span>        <span class="n">NaN</span>         <span class="n">NaN</span>
<span class="mi">3</span>  <span class="mf">0.0300</span>        <span class="n">NaN</span>         <span class="n">NaN</span>
<span class="mi">4</span>  <span class="mf">0.0300</span>        <span class="n">NaN</span>         <span class="n">NaN</span>
<span class="mi">5</span>  <span class="mf">0.0450</span>   <span class="mf">0.731802</span>    <span class="mf">0.714871</span>
<span class="mi">6</span>  <span class="mf">0.0725</span>   <span class="mf">0.372052</span>    <span class="mf">0.467960</span>
<span class="mi">7</span>  <span class="mf">0.1045</span>   <span class="mf">0.218834</span>    <span class="mf">0.244265</span>
<span class="mi">8</span>  <span class="mf">0.1900</span>   <span class="mf">0.075294</span>    <span class="mf">0.044097</span>
<span class="mi">9</span>  <span class="mf">1.2955</span>   <span class="mf">0.003497</span>    <span class="mf">0.000133</span>
</pre></div>
</div>
<div class="highlight-python notranslate" id="road-edge-effect"><div class="highlight"><pre><span></span><span class="c1"># Plot relationships</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_dist_road_edge_effect.png&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s2">&quot;111&quot;</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_road</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">theta_road</span><span class="p">[</span><span class="s2">&quot;theta_obs&quot;</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_road</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">theta_road</span><span class="p">[</span><span class="s2">&quot;theta_icar&quot;</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;road&quot;</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_edge</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">theta_edge</span><span class="p">[</span><span class="s2">&quot;theta_obs&quot;</span><span class="p">],</span> <span class="s2">&quot;go&quot;</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_edge</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">theta_edge</span><span class="p">[</span><span class="s2">&quot;theta_icar&quot;</span><span class="p">],</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;forest edge&quot;</span><span class="p">)</span>
<span class="c1"># Format plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distance to:&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance (km)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Spatial probability of deforestation&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<p>Figure 1: <strong>Effects of roads, and distance to forest edge on the spatial probability of deforestation</strong> The dots represent the local
mean probability of deforestation for each bin of 10 percentiles for
the distance. Lines represent the mean of the predicted probabilities
of deforestation obtained from the deforestation model for all
observations in each bin. (Note that for distance to forest edge, the
first dot accounts for six bins while for distance to road, the bin
for a distance &gt; 10 km is not shown).</p>
<a class="reference internal image-reference" href="../../_images/nb_newcal_dist_road_edge_effect.png" id="fig-road-edge-effect"><img alt="../../_images/nb_newcal_dist_road_edge_effect.png" id="fig-road-edge-effect" src="../../_images/nb_newcal_dist_road_edge_effect.png" style="width: 600px;" /></a>
</section>
<section id="effect-of-ultramafic-soils">
<h3>6.3 Effect of ultramafic soils<a class="headerlink" href="#effect-of-ultramafic-soils" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change in deforestation probability on ultramafic soils</span>
<span class="n">alpha_normalized</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.85</span>
<span class="n">coef_geol</span> <span class="o">=</span> <span class="mf">0.349</span>
<span class="n">theta_mean</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span><span class="p">)</span> <span class="c1"># Mean deforestation probability</span>
<span class="n">theta_geol</span> <span class="o">=</span> <span class="n">inv_logit</span><span class="p">(</span><span class="n">alpha_normalized</span> <span class="o">+</span> <span class="n">coef_geol</span><span class="p">)</span>
<span class="n">d_geol</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">theta_geol</span><span class="o">/</span><span class="n">theta_mean</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d_geol: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_geol</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d_geol</span><span class="p">:</span> <span class="mf">34.0</span><span class="o">%</span>
</pre></div>
</div>
<p>On average, being on ultramafic soils increases the deforestation
probability by 34%.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                       <span class="s2">&quot;theta_obs&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="s2">&quot;theta_icar&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)})</span>
<span class="n">w0</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;geol&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">);</span> <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;geol&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;theta_obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">w0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">w0</span><span class="p">])</span>
<span class="n">df_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;theta_obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">w1</span><span class="p">])</span>
<span class="n">df_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;theta_icar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w0</span><span class="p">,</span> <span class="s2">&quot;icar&quot;</span><span class="p">])</span>
<span class="n">df_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;theta_icar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w1</span><span class="p">,</span> <span class="s2">&quot;icar&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_out</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>  <span class="n">theta_obs</span>  <span class="n">theta_icar</span>
<span class="mi">0</span>  <span class="mi">0</span>   <span class="mf">0.484320</span>    <span class="mf">0.484171</span>
<span class="mi">1</span>  <span class="mi">1</span>   <span class="mf">0.522406</span>    <span class="mf">0.522300</span>
</pre></div>
</div>
<div class="highlight-python notranslate" id="geol-effect"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_geol_effect.png&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s2">&quot;111&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;theta_obs&quot;</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">df_out</span><span class="p">[</span><span class="s2">&quot;theta_icar&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;No peridotite&quot;</span><span class="p">,</span> <span class="s2">&quot;Peridotite&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Spatial probability of deforestation&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<p>Figure 2: <strong>Effects of the presence of peridotite beds on the spatial probability of deforestation</strong> The dots represent the observed mean
probability of deforestation in each geological class, either without
or with peridotite beds. Bars represent the mean of the predicted
probabilities of deforestation obtained from the deforestation model
for all observations in each class.</p>
<a class="reference internal image-reference" href="../../_images/nb_newcal_geol_effect.png" id="fig-geol-effect"><img alt="../../_images/nb_newcal_geol_effect.png" id="fig-geol-effect" src="../../_images/nb_newcal_geol_effect.png" style="width: 600px;" /></a>
</section>
</section>
<section id="predictions">
<h2>7 Predictions<a class="headerlink" href="#predictions" title="Permalink to this heading">¶</a></h2>
<section id="interpolate-spatial-random-effects">
<h3>7.1 Interpolate spatial random effects<a class="headerlink" href="#interpolate-spatial-random-effects" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Spatial random effects</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">rho</span>

<span class="c1"># Interpolate</span>
<span class="n">far</span><span class="o">.</span><span class="n">interpolate_rho</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">input_raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span>
              <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span>
              <span class="n">csize_orig</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">csize_new</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Write</span> <span class="n">spatial</span> <span class="n">random</span> <span class="n">effect</span> <span class="n">data</span> <span class="n">to</span> <span class="n">disk</span>
<span class="n">Compute</span> <span class="n">statistics</span>
<span class="n">Build</span> <span class="n">overview</span>
<span class="n">Resampling</span> <span class="n">spatial</span> <span class="n">random</span> <span class="n">effects</span> <span class="n">to</span> <span class="n">file</span> <span class="n">output</span><span class="o">/</span><span class="n">rho</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
</section>
<section id="predict-deforestation-probability">
<h3>7.2 Predict deforestation probability<a class="headerlink" href="#predict-deforestation-probability" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update dist_edge and dist_defor at t3</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;data/dist_edge.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_edge.tif.bak&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;data/dist_defor.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_defor.tif.bak&quot;</span><span class="p">)</span>
<span class="n">copy2</span><span class="p">(</span><span class="s2">&quot;data/forecast/dist_edge_forecast.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_edge.tif&quot;</span><span class="p">)</span>
<span class="n">copy2</span><span class="p">(</span><span class="s2">&quot;data/forecast/dist_defor_forecast.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_defor.tif&quot;</span><span class="p">)</span>

<span class="c1"># Compute predictions</span>
<span class="n">far</span><span class="o">.</span><span class="n">predict_raster_binomial_iCAR</span><span class="p">(</span>
  <span class="n">mod_binomial_iCAR</span><span class="p">,</span> <span class="n">var_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
  <span class="n">input_cell_raster</span><span class="o">=</span><span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span>
  <span class="n">input_forest_raster</span><span class="o">=</span><span class="s2">&quot;data/forest/forest_t3.tif&quot;</span><span class="p">,</span>
  <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/prob.tif&quot;</span><span class="p">,</span>
  <span class="n">blk_rows</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Reduced number of lines to avoid memory problems</span>
<span class="p">)</span>

<span class="c1"># Reinitialize data</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;data/dist_edge.tif&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;data/dist_defor.tif&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;data/dist_edge.tif.bak&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_edge.tif&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;data/dist_defor.tif.bak&quot;</span><span class="p">,</span> <span class="s2">&quot;data/dist_defor.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="project-future-forest-cover-change">
<h2>8 Project future forest cover change<a class="headerlink" href="#project-future-forest-cover-change" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Forest cover</span>
<span class="n">fc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;2005&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="s2">&quot;2015&quot;</span><span class="p">,</span> <span class="s2">&quot;t3&quot;</span><span class="p">]</span>
<span class="n">ndates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndates</span><span class="p">):</span>
  <span class="n">rast</span> <span class="o">=</span> <span class="s2">&quot;data/forest/forest_&quot;</span> <span class="o">+</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tif&quot;</span>
  <span class="n">val</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">countpix</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="n">rast</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">fc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])</span>  <span class="c1"># area in ha</span>
<span class="c1"># Save results to disk</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/forest_cover.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fc</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># Annual deforestation</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">annual_defor</span> <span class="o">=</span> <span class="p">(</span><span class="n">fc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">fc</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">/</span> <span class="n">T</span>

<span class="c1"># Dates and time intervals</span>
<span class="n">dates_fut</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2030&quot;</span><span class="p">,</span> <span class="s2">&quot;2035&quot;</span><span class="p">,</span> <span class="s2">&quot;2040&quot;</span><span class="p">,</span> <span class="s2">&quot;2050&quot;</span><span class="p">,</span> <span class="s2">&quot;2055&quot;</span><span class="p">,</span> <span class="s2">&quot;2060&quot;</span><span class="p">,</span> <span class="s2">&quot;2070&quot;</span><span class="p">,</span> <span class="s2">&quot;2080&quot;</span><span class="p">,</span> <span class="s2">&quot;2085&quot;</span><span class="p">,</span> <span class="s2">&quot;2090&quot;</span><span class="p">,</span> <span class="s2">&quot;2100&quot;</span><span class="p">]</span>
<span class="n">ndates_fut</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates_fut</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop on dates</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndates_fut</span><span class="p">):</span>
  <span class="c1"># Amount of deforestation (ha)</span>
  <span class="n">defor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">annual_defor</span> <span class="o">*</span> <span class="n">ti</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="c1"># Compute future forest cover</span>
  <span class="n">stats</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">deforest</span><span class="p">(</span>
      <span class="n">input_raster</span><span class="o">=</span><span class="s2">&quot;output/prob.tif&quot;</span><span class="p">,</span>
      <span class="n">hectares</span><span class="o">=</span><span class="n">defor</span><span class="p">,</span>
      <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/fcc_&quot;</span> <span class="o">+</span> <span class="n">dates_fut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span>
      <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
  <span class="c1"># Save some stats if date = 2050</span>
  <span class="k">if</span> <span class="n">dates_fut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2050&quot;</span><span class="p">:</span>
      <span class="c1"># Save stats to disk with pickle</span>
      <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/stats.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
      <span class="c1"># Plot histograms of probabilities</span>
      <span class="n">fig_freq</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">freq_prob</span><span class="p">(</span>
      <span class="n">stats</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/freq_prob.png&quot;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_freq</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="figures">
<h2>9 Figures<a class="headerlink" href="#figures" title="Permalink to this heading">¶</a></h2>
<section id="historical-forest-cover-change">
<h3>9.1 Historical forest cover change<a class="headerlink" href="#historical-forest-cover-change" title="Permalink to this heading">¶</a></h3>
<p>Forest cover change for the period 2000-2010-2020</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot forest</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_fcc123.png&quot;</span>
<span class="n">fig_fcc123</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc123</span><span class="p">(</span>
    <span class="n">input_fcc_raster</span><span class="o">=</span><span class="s2">&quot;data/forest/fcc123.tif&quot;</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/nb_newcal_fcc123.png"><img alt="../../_images/nb_newcal_fcc123.png" src="../../_images/nb_newcal_fcc123.png" style="width: 600px;" /></a>
</section>
<section id="spatial-random-effects">
<h3>9.2 Spatial random effects<a class="headerlink" href="#spatial-random-effects" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original spatial random effects</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_rho_orig.png&quot;</span>
<span class="n">fig_rho_orig</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span>
    <span class="s2">&quot;output/rho_orig.tif&quot;</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="c1"># Interpolated spatial random effects</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_rho.png&quot;</span>
<span class="n">fig_rho</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span>
    <span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/nb_newcal_rho.png"><img alt="../../_images/nb_newcal_rho.png" src="../../_images/nb_newcal_rho.png" style="width: 600px;" /></a>
</section>
<section id="spatial-probability-of-deforestation">
<h3>9.3 Spatial probability of deforestation<a class="headerlink" href="#spatial-probability-of-deforestation" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Spatial probability of deforestation</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_prob.png&quot;</span>
<span class="n">fig_prob</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span>
    <span class="s2">&quot;output/prob.tif&quot;</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/nb_newcal_prob.png"><img alt="../../_images/nb_newcal_prob.png" src="../../_images/nb_newcal_prob.png" style="width: 600px;" /></a>
</section>
<section id="future-forest-cover">
<h3>9.4 Future forest cover<a class="headerlink" href="#future-forest-cover" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_fcc_2050.png&quot;</span>
<span class="c1"># Projected forest cover change (2020-2050)</span>
<span class="n">fcc_2050</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc</span><span class="p">(</span>
    <span class="s2">&quot;output/fcc_2050.tif&quot;</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/nb_newcal_fcc_2050.png"><img alt="../../_images/nb_newcal_fcc_2050.png" src="../../_images/nb_newcal_fcc_2050.png" style="width: 600px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Projected forest cover change (2020-2100)</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s2">&quot;output/nb_newcal_fcc_2100.png&quot;</span>
<span class="n">fcc_2100</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc</span><span class="p">(</span>
    <span class="s2">&quot;output/fcc_2100.tif&quot;</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="s2">&quot;data/ctry_PROJ.shp&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/nb_newcal_fcc_2100.png"><img alt="../../_images/nb_newcal_fcc_2100.png" src="../../_images/nb_newcal_fcc_2100.png" style="width: 600px;" /></a>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Ghislain Vieilledent.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/notebooks/new_caledonia/new_caledonia.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>